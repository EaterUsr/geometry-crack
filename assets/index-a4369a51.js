var O=Object.defineProperty;var B=(s,t,i)=>t in s?O(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var h=(s,t,i)=>(B(s,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();class g{constructor(){h(this,"head");h(this,"tail");h(this,"length",0);this.head=null,this.tail=null}makeNode(t){return{value:t,next:null}}append(t){let i=this.makeNode(t);return this.length++,this.tail?(this.tail.next=i,this.tail=i,i):(this.head=this.tail=i,i)}forEach(t){let i=this.head,n=0;for(;i;)t(i.value,n),i=i.next,n++}removeFirst(){if(this.length--,!this.head)return null;let t=this.head;return this.head=t.next,t.next=null,t===this.tail&&(this.tail=null),t}}class y{constructor(t,{speed:i}){h(this,"globalSpeed");h(this,"timeBetweenDecorations",0);h(this,"content",new g);h(this,"speed",0);h(this,"count",0);this.canvas=t,this.globalSpeed=i,this.content=new g,setTimeout(()=>{this.calcSpeed(),this.calcTimeBetweenDecorations(),this.calcCount(),this.instanceEach(),setInterval(()=>this.interval(),this.timeBetweenDecorations)},0)}calcSpeed(){this.speed=this.globalSpeed/this.depth}calcCount(){this.count=1+1/this.frequency}calcTimeBetweenDecorations(){this.timeBetweenDecorations=this.canvas.width*this.frequency/this.speed}instanceEach(){for(let t=0;t<this.count;t++)this.content.append(this.instance());this.content.forEach((t,i)=>{t.update(this.timeBetweenDecorations*(this.count-i))})}interval(){this.content.append(this.instance()),this.content.removeFirst()}instance(){return this.instanceDecoration(this.canvas,this.speed)}update(t){this.content.forEach(i=>{i.update(t)})}}function j(s,t,i){return s+t*i}function S(s,t,i){return s-t*i}class C{constructor(t,i){h(this,"path",new Path2D);h(this,"position",0);this.canvas=t,this.speed=i,this.setPath()}update(t){const i=this.canvas.width-this.position;this.canvas.ctx.save(),this.canvas.ctx.fillStyle=this.color,this.canvas.ctx.translate(i,this.y),this.canvas.ctx.scale(this.sizeX,this.sizeY),this.draw(),this.canvas.ctx.restore(),this.forward(t)}forward(t){this.position=j(this.position,this.speed,t)}}function u(s,t,i=1){return s*=i,t*=i,Math.random()*(t-s)+s}function P(s,t){return Math.abs(s-t)}const w=[...new Array(5)].map((s,t)=>t*90);function A(s){const t=[...new Array(5)].map((e,o)=>P(w[o],s));let i=361,n=0;return t.forEach((e,o)=>{i>e&&(i=e,n=o)}),w[n]}function E(s){return s*Math.PI/180}function f(s){return s/180*Math.PI}function _(s,...t){const i=t.map(r=>s(...r)),n=i.map(r=>Math.abs(r)),e=Math.min(...n);let o=0;return n.forEach((r,c)=>{r===e&&(o=i[c])}),o}function d(s=2){return function(t,i){const n=t[i];Object.defineProperty(t,i,{get:()=>n,set:e=>{if(typeof e!="number")throw new Error("Invalid property: Exepted number");const o=10**s;return Math.floor(e*o)/o}})}}var q=Object.defineProperty,N=Object.getOwnPropertyDescriptor,F=(s,t,i,n)=>{for(var e=n>1?void 0:n?N(t,i):t,o=s.length-1,r;o>=0;o--)(r=s[o])&&(e=(n?r(t,i,e):r(e))||e);return n&&e&&q(t,i,e),e};class m extends C{constructor(){super(...arguments);h(this,"y",u(.3,1.5,this.canvas.height/10));h(this,"isReturned",Boolean(Math.floor(u(0,2))));h(this,"sizeY",u(1.1,1.5,this.canvas.width/1e3));h(this,"sizeX",this.isReturned?-this.sizeY:this.sizeY);h(this,"color","#fff")}setPath(){this.path.moveTo(20,50),this.path.arcTo(-30,40,20,20,15),this.path.arcTo(20,-15,60,20,17),this.path.arcTo(70,-10,80,25,17),this.path.arcTo(100,-10,100,25,15),this.path.arcTo(150,35,110,50,15),this.path.arcTo(110,100,70,60,15),this.path.arcTo(65,80,40,50,17),this.path.arcTo(30,80,20,50,17),this.path.closePath()}draw(){this.isReturned&&this.canvas.ctx.translate(this.sizeY*-110,0),this.canvas.ctx.fill(this.path)}}F([d()],m.prototype,"y",2);F([d()],m.prototype,"isReturned",2);class k extends y{constructor(){super(...arguments);h(this,"frequency",.3);h(this,"depth",4)}instanceDecoration(i,n){return new m(i,n)}}var L=Object.defineProperty,R=Object.getOwnPropertyDescriptor,T=(s,t,i,n)=>{for(var e=n>1?void 0:n?R(t,i):t,o=s.length-1,r;o>=0;o--)(r=s[o])&&(e=(n?r(t,i,e):r(e))||e);return n&&e&&L(t,i,e),e};class v extends C{constructor(){super(...arguments);h(this,"y",u(7,7.5,this.canvas.height/10));h(this,"sizeX",u(8,13,this.canvas.width/1e4));h(this,"sizeY",this.sizeX);h(this,"color","#8B3E00")}setPath(){this.path.arc(40,40,40,0,Math.PI*2)}draw(){this.canvas.ctx.fill(this.path)}}T([d()],v.prototype,"y",2);T([d()],v.prototype,"sizeX",2);class I extends y{constructor(){super(...arguments);h(this,"frequency",.25);h(this,"depth",1)}instanceDecoration(i,n){return new v(i,n)}}class Y{constructor(t){h(this,"colors",{sky:"#00C2FF",floor:"#9B5400",grass:"#1CA600"});h(this,"config");h(this,"clouds");h(this,"dirts");this.canvas=t;const i=t.width/1460,n=Math.floor(t.height/9),e=[Math.floor(t.width/2-n/2),Math.floor(t.height/2-n/2)],o=Math.floor(n/i),r=Math.floor(e[1]+n),c=Math.floor(t.height/20);this.config={speed:i,blockSize:n,cubeOrigin:e,timePerBlock:o,floorHeight:r,grassHeight:c},this.clouds=new k(this.canvas,this.config),this.dirts=new I(this.canvas,this.config)}updateBackground(t){this.setSky(),this.clouds.update(t)}updateForeground(t){this.setFloor(),this.setGrass(),this.dirts.update(t)}setSky(){this.canvas.ctx.fillStyle=this.colors.sky,this.canvas.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}setFloor(){this.canvas.ctx.fillStyle=this.colors.floor,this.canvas.ctx.fillRect(0,this.config.floorHeight,this.canvas.width,Math.floor(this.canvas.height/2-this.config.blockSize/2))}setGrass(){this.canvas.ctx.fillStyle=this.colors.grass,this.canvas.ctx.fillRect(0,this.config.floorHeight,this.canvas.width,this.config.grassHeight)}}function X(s,t,i,n){const e=[...new Array(4)],o=[s+n/2,t+n/2];for(let r in e){const c=Math.sin(f(i+Number(r)*90-45))*Math.sqrt((n/2)**2*2)+o[0],a=Math.cos(f(i+Number(r)*90-45))*Math.sqrt((n/2)**2*2)+o[1];e[r]=[c,a]}return e}function $(s,t,i,n){const e=[...new Array(4)],o=[s+i/2,t+n/2];for(let r in e){const c=Math.sin(f(Number(r)*90-45))*Math.sqrt((i/2)**2*2)+o[0],a=Math.cos(f(Number(r)*90-45))*Math.sqrt((n/2)**2*2)+o[1];e[r]=[c,a]}return e}function G(s,t,i){return[[s,t+i],[s+i/2,t],[s+i,t+i]]}function J(s,t,i,n,e,o,r,c){const a=((r-e)*(t-o)-(c-o)*(s-e))/((c-o)*(i-s)-(r-e)*(n-t)),l=((i-s)*(t-o)-(n-t)*(s-e))/((c-o)*(i-s)-(r-e)*(n-t));return a>=0&&a<=1&&l>=0&&l<=1}function K(s,t){for(let i=0;i<s.length;i++){let n=Number(i)+1;n===s.length&&(n=0);const e=s[i],o=s[n],r=W(e[0],e[1],o[0],o[1],t);if(r)return r}return!1}function W(s,t,i,n,e){for(let o=0;o<e.length;o++){let r=Number(o)+1;r===e.length&&(r=0);const c=e[o],a=e[r],l=J(c[0],c[1],a[0],a[1],s,t,i,n);if(l)return l}return!1}function x(s,t,i,n){const e=n?_((o,r)=>o-r,[t,s],[t+n,s],[t,s+n]):t-s;return Math.abs(e)>i?e>0?s+i:s-i:t}function z(s,t,i,n){const{content:e,target:o,speed:r}=s;if(s.content instanceof Array){const c=s.content,a=s.target;s.content=c.map((l,b)=>{const p=a[b];return p!==null&&p!==l?x(l,p,r*t,n):(a!==null&&(s.target[b]=null),l)}),a.some(l=>l===null)&&i(s.target.map(l=>l===null),c);return}typeof o=="number"&&!(e instanceof Array)&&(s.content=x(e,o,r*t,n),e===o&&(s.target=null)),i(!1,e)}class U{constructor({ctx:t},i){h(this,"ctx");h(this,"floorHeight");h(this,"speedFrame",0);h(this,"deg");h(this,"origin");h(this,"velocity",0);h(this,"isFalling",!0);h(this,"canForward",!0);h(this,"size");h(this,"center");h(this,"jumpHeight",0);this.graphics=i,this.origin={content:i.cubeOrigin,target:[null,null],speed:i.speed},this.deg={content:0,speed:.6,target:null},this.ctx=t,this.floorHeight=i.floorHeight,this.size=this.graphics.blockSize,this.center=this.updateCenter()}get hitbox(){return X(this.origin.content[0],this.origin.content[1]-this.jumpHeight,360-this.deg.content,this.size)}updateCenter(){return[this.origin.content[0]+this.size/2,this.origin.content[1]-this.jumpHeight+this.size/2]}touchTheFloor(){return this.origin.content[1]-this.jumpHeight+this.size>=this.floorHeight}update(t){this.speedFrame=t,this.ctx.fillStyle="#000",this.velocity-=this.velocity===0?0:1,this.jumpHeight+=this.velocity*t*.05,this.deg.content%=360,this.touchTheFloor()&&this.isFalling&&(this.isFalling=!1,this.jumpHeight=0,this.velocity=0,this.deg.target=A(this.deg.content),this.deg.target%=360,this.origin.content[1]=this.floorHeight-this.size),z(this.deg,t,(n,e)=>{this.isFalling&&(this.deg.content=e+.5*this.speedFrame)},360),z(this.origin,t,([n,e])=>{this.isFalling&&e&&(this.jumpHeight-=7),!this.canForward&&n&&(this.origin.content[0]=S(this.origin.content[0],this.graphics.speed,t))});const i=[this.origin.content[0],this.origin.content[1]-this.jumpHeight];this.center=this.updateCenter(),this.ctx.save(),this.ctx.translate(...this.center),this.ctx.rotate(E(this.deg.content)),this.ctx.translate(-this.center[0],-this.center[1]),this.ctx.fillRect(...i,this.size,this.size),this.ctx.restore(),this.canForward=!0}jump(){this.touchTheFloor()&&(this.velocity=22,this.isFalling=!0)}onSlabCollision(t){if(this.center[0]>=t[0]){setTimeout(()=>{this.isFalling=!0,this.floorHeight=this.graphics.floorHeight},this.graphics.timePerBlock),this.floorHeight=t[1],this.origin.target=[null,t[1]-this.size];return}this.isFalling=!0,this.origin.target=[t[0]-this.size,this.floorHeight-this.size],this.canForward=!1}}class D{constructor({ctx:t},i,n,e){h(this,"ctx");this.position=i,this.speed=n,this.size=e,this.ctx=t}update(t){this.position[0]=S(this.position[0],this.speed,t),this.ctx.save(),this.ctx.translate(...this.position),this.ctx.fillStyle=this.color,this.drawPatern(),this.ctx.restore()}}class V extends D{constructor(){super(...arguments);h(this,"color","#f00")}get hitbox(){return G(...this.position,this.size)}onCollision(){console.log("game over")}drawPatern(){this.ctx.beginPath(),this.ctx.moveTo(0,this.size),this.ctx.lineTo(this.size/2,0),this.ctx.lineTo(this.size,this.size),this.ctx.closePath(),this.ctx.fill()}}class Z extends D{constructor(i,n,e,o,r){super(i,n,e,o);h(this,"color","#000");this.cubeOnSlabCollision=r}get hitbox(){return $(...this.position,this.size,this.size/2)}onCollision(){this.cubeOnSlabCollision(this.position)}drawPatern(){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.size,0),this.ctx.lineTo(this.size,this.size/2),this.ctx.lineTo(0,this.size/2),this.ctx.closePath(),this.ctx.fill()}}class Q{constructor(t,i,n,e){h(this,"content",new g);this.cubeSize=t,this.canvas=i,this.graphics=n,this.onCubeSlabCollision=e}add(t,i){const n=[this.canvas,[this.canvas.width,i?this.graphics.cubeOrigin[1]-i*this.graphics.blockSize:this.graphics.cubeOrigin[1]],this.graphics.speed,this.graphics.blockSize];let e;switch(t){case"Spike":e=new V(...n);break;case"Slab":e=new Z(...n,this.onCubeSlabCollision);break}this.content.append(e)}update(t,i,n){this.content.forEach(e=>{e.update(i),e.position[0]>=t[0]-this.cubeSize&&e.position[0]<t[0]+this.cubeSize&&K(e.hitbox,n)&&e.onCollision(),e.position[0]+e.size<0&&setTimeout(()=>{this.content.removeFirst()},0)})}}class tt{constructor(t){h(this,"config");h(this,"isActive",!1);h(this,"lastFrame",Date.now());h(this,"blocks");h(this,"graphics");h(this,"cube");const i=document.querySelector(t);if(!i)throw new Error(`Invalid input: The query ${t} does not match any HTML element`);this.config={ctx:i.getContext("2d"),width:i.width,height:i.height},this.graphics=new Y(this.config),this.cube=new U(this.config,this.graphics.config),this.blocks=new Q(this.cube.size,this.config,this.graphics.config,this.cube.onSlabCollision.bind(this.cube))}jump(){this.cube.jump()}start(){this.isActive=!0,this.animate()}addBlock(t){this.blocks.add(t)}animate(){this.isActive&&window.requestAnimationFrame(this.animate.bind(this));const t=Date.now()-this.lastFrame;this.lastFrame=Date.now(),this.graphics.updateBackground(t),this.blocks.update(this.cube.origin.content,t,this.cube.hitbox),this.cube.update(t),this.graphics.updateForeground(t)}stop(){this.isActive=!1}}const M=new tt("#game");M.start();document.addEventListener("keyup",s=>{const{key:t}=s;(t===" "||t==="ArrowUp")&&H()});document.addEventListener("click",()=>H());function H(){M.jump()}
